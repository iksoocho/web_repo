<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>student/studentInfo.html</title>
</head>

<body>
    <div id="show">
        <table border="1">
            <thead>
                <tr>
                    <th>아이디</th>
                    <th>이름</th>
                    <th>생년월일</th>
                    <th>삭제</th>
                </tr>
            </thead>
            <tbody id="list">

            </tbody>
        </table>
    </div>
    <script>
        //페이지가 로딩 되면서 바로 실행
        fetch('../studentList.do')
        .then(resolve => resolve.json())
        .then(result =>{
            console.log(result);
            let tbody = document.querySelector('#list');
            result.forEach(student => {
                tbody.append(makeTr(student));
            });
        })
        .catch(err=> console.log('error : ',err));

        function makeTr(obj){
            let showFields = ['studentId', 'studentName', 'studentBirthday'];
            let tr = document.createElement('tr');

            for (let prop of showFields) {
            let td = document.createElement('td')
            td.innerHTML = obj[prop];
            tr.append(td);
        }
        //삭제 버튼
        let td = document.createElement('td');
        let btn = document.createElement('button')
        btn.setAttribute('data-sid',obj.studentId);
        btn.addEventListener('click',function(e){
            //ajax 호출 -> 삭제 servlet 호출(db)과 화면 출력을 동시에 처리 
            fetch('../delStudent.do?sid='+obj.studentId)
            .then(resolve => resolve.json())
            .then(result => {
				if(result.retCode == 'OK'){
                    alert('삭제 성공');
                    tr.remove();
                }else{
                    alert('삭제 실패');
                }
			})
			.catch(err=>console.log('error : ',err))
        });
        btn.innerHTML = "삭제"
        td.append(btn)
        tr.append(td);
        return tr;
        }
    </script>
</body>

</html>